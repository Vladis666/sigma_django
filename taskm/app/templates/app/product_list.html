{% extends 'base.html' %}

{% block title %}–¢–æ–≤–∞—Ä–∏ | –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–¥–∞–∂—ñ–≤{% endblock %}

{% block content %}
<div class="header">
    <h1>–¢–æ–≤–∞—Ä–∏</h1>
    <a href="/admin/sales_app/product/add/" class="btn">–î–æ–¥–∞—Ç–∏ —Ç–æ–≤–∞—Ä</a>
</div>

<div class="card">
    <table>
        <thead>
        <tr>
            <th>–ù–∞–∑–≤–∞</th>
            <th>–¶—ñ–Ω–∞</th>
            <th>–ö—ñ–ª—å–∫—ñ—Å—Ç—å</th>
            <th>–°—Ç–∞—Ç—É—Å</th>
            <th>–î—ñ—ó</th>
        </tr>
        </thead>
        <tbody>
        {% for product in products %}
        <tr class="{% if product.quantity <= 5 %}low-stock-critical{% elif product.quantity <= 10 %}low-stock-warning{% endif %}">
            <td>{{ product.name }}</td>
            <td>{{ product.price }} –≥—Ä–Ω</td>
            <td>{{ product.quantity }} —à—Ç.</td>
            <td>
                    <span style="display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;
                        {% if product.active %}
                            background-color: #e3f9e5; color: #1e7e34;
                        {% else %}
                            background-color: #f8d7da; color: #721c24;
                        {% endif %}
                    ">
                        {% if product.active %}–ê–∫—Ç–∏–≤–Ω–∏–π{% else %}–ù–µ–∞–∫—Ç–∏–≤–Ω–∏–π{% endif %}
                    </span>
            </td>
            <td>
                <div style="display: flex; gap: 5px;">
                    <a href="/admin/sales_app/product/{{ product.id }}/change/" class="btn btn-secondary" style="padding: 4px 8px; font-size: 0.9rem;">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a>
                </div>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="5" style="text-align: center;">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –ø—Ä–æ —Ç–æ–≤–∞—Ä–∏</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<div class="card" style="margin-top: 30px; display: flex; flex-wrap: wrap; gap: 20px; align-items: stretch;">
    <!-- Low stock products -->
    <div style="flex: 1; min-width: 300px; background-color: var(--gray-100); border-radius: 8px; padding: 15px;">
        <h2 style="margin-top: 0; padding-bottom: 10px; border-bottom: 1px solid var(--gray-300);">
            <span style="color: var(--orange-600);">‚ö†Ô∏è</span> –¢–æ–≤–∞—Ä–∏ –∑ –º–∞–ª–∏–º –∑–∞–ø–∞—Å–æ–º
        </h2>
        <div style="display: flex; flex-direction: column; gap: 10px;">
            {% for product in products %}
            {% if product.quantity <= 10 %}
            <div style="background-color: white; padding: 10px; border-radius: 4px;
                    border-left: 4px solid {% if product.quantity <= 5 %}var(--danger){% else %}var(--warning){% endif %};">
                <div style="font-weight: bold;">{{ product.name }}</div>
                <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                    <div>–ó–∞–ª–∏—à–æ–∫: <strong>{{ product.quantity }} —à—Ç.</strong></div>
                    <div>{{ product.price }} –≥—Ä–Ω</div>
                </div>
            </div>
            {% endif %}
            {% endfor %}

            {% with low_stock_count=0 %}
            {% for product in products %}
            {% if product.quantity <= 10 %}
            {% with low_stock_count=1 %}{% endwith %}
            {% endif %}
            {% endfor %}

            {% if low_stock_count == 0 %}
            <div style="text-align: center; padding: 20px; color: var(--gray-600);">
                –ù–µ–º–∞—î —Ç–æ–≤–∞—Ä—ñ–≤ –∑ –º–∞–ª–∏–º –∑–∞–ø–∞—Å–æ–º
            </div>
            {% endif %}
            {% endwith %}
        </div>
    </div>

    <!-- Active vs Inactive statistics -->
    <div style="flex: 1; min-width: 300px; background-color: var(--gray-100); border-radius: 8px; padding: 15px;">
        <h2 style="margin-top: 0; padding-bottom: 10px; border-bottom: 1px solid var(--gray-300);">
            <span style="color: var(--info);">üìä</span> –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ç–æ–≤–∞—Ä—ñ–≤
        </h2>
        <div style="display: flex; flex-direction: column; gap: 10px;">
            <!-- Total products -->
            <div style="background-color: white; padding: 15px; border-radius: 4px; text-align: center;">
                <div style="font-size: 0.9rem; color: var(--gray-600);">–í—Å—å–æ–≥–æ —Ç–æ–≤–∞—Ä—ñ–≤</div>
                <div style="font-size: 2rem; font-weight: bold; color: var(--gray-800);">{{ products|length }}</div>
            </div>

            <!-- Active products -->
            <div style="background-color: white; padding: 15px; border-radius: 4px; text-align: center;">
                <div style="font-size: 0.9rem; color: var(--gray-600);">–ê–∫—Ç–∏–≤–Ω–∏—Ö —Ç–æ–≤–∞—Ä—ñ–≤</div>
                <div style="font-size: 2rem; font-weight: bold; color: var(--success);">
                    {% with active_count=0 %}
                    {% for product in products %}
                    {% if product.active %}
                    {% with active_count=active_count|add:1 %}{% endwith %}
                    {% endif %}
                    {% endfor %}

                    {{ active_count }}
                    <div style="font-size: 0.9rem; color: var(--gray-600);">
                        {% if products|length > 0 %}
                        {{ active_count|floatformat:0 }}%
                        {% else %}
                        0%
                        {% endif %}
                    </div>
                    {% endwith %}
                </div>
            </div>

            <!-- Low stock products -->
            <div style="background-color: white; padding: 15px; border-radius: 4px; text-align: center;">
                <div style="font-size: 0.9rem; color: var(--gray-600);">–¢–æ–≤–∞—Ä—ñ–≤ –∑ –º–∞–ª–∏–º –∑–∞–ø–∞—Å–æ–º</div>
                <div style="font-size: 2rem; font-weight: bold; color: var(--warning);">
                    {% with low_stock_count=0 %}
                    {% for product in products %}
                    {% if product.quantity <= 10 %}
                    {% with low_stock_count=low_stock_count|add:1 %}{% endwith %}
                    {% endif %}
                    {% endfor %}

                    {{ low_stock_count }}
                    {% endwith %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
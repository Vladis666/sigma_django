{% extends 'base.html' %}

{% block title %}–¢–∞–±–ª–∏—Ü—è –ª—ñ–¥–µ—Ä—ñ–≤ | –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–¥–∞–∂—ñ–≤{% endblock %}

{% block extra_head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block content %}
<h1>–¢–∞–±–ª–∏—Ü—è –ª—ñ–¥–µ—Ä—ñ–≤ –∑–∞ –æ—Å—Ç–∞–Ω–Ω—ñ 30 –¥–Ω—ñ–≤</h1>

<!-- –¢–∞–±–ª–∏—Ü—è –ª—ñ–¥–µ—Ä—ñ–≤ -->
<div class="card card-highlight">
    <table>
        <thead>
        <tr>
            <th width="70">–ú—ñ—Å—Ü–µ</th>
            <th>–ü—Ä–∞—Ü—ñ–≤–Ω–∏–∫</th>
            <th>–ü–æ—Å–∞–¥–∞</th>
            <th>–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ä–æ–¥–∞–∂—ñ–≤</th>
        </tr>
        </thead>
        <tbody>
        {% for employee in leaders %}
        <tr class="{% if forloop.counter == 1 %}gold-leader{% elif forloop.counter == 2 %}silver-leader{% elif forloop.counter == 3 %}bronze-leader{% endif %}">
            <td style="text-align: center; font-weight: bold;">
                {% if forloop.counter == 1 %}
                <span style="font-size: 1.5em; color: var(--orange-500);">üèÜ</span>
                {% elif forloop.counter == 2 %}
                <span style="font-size: 1.3em; color: var(--gray-600);">ü•à</span>
                {% elif forloop.counter == 3 %}
                <span style="font-size: 1.2em; color: #cd7f32;">ü•â</span>
                {% else %}
                {{ forloop.counter }}
                {% endif %}
            </td>
            <td>{{ employee.user.get_full_name }}</td>
            <td>{{ employee.position }}</td>
            <td>{{ employee.sales_count }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="4" style="text-align: center;">–ù–µ–º–∞—î –¥–∞–Ω–∏—Ö –ø—Ä–æ –ø—Ä–æ–¥–∞–∂—ñ</td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
</div>

<!-- –ì—Ä–∞—Ñ—ñ–∫ —Ç—Ä–µ–Ω–¥—ñ–≤ –ø—Ä–æ–¥–∞–∂—ñ–≤ -->
<div class="card" style="margin-top: 30px;">
    <h2>–¢—Ä–µ–Ω–¥–∏ –ø—Ä–æ–¥–∞–∂—ñ–≤ –∑–∞ –æ—Å—Ç–∞–Ω–Ω—ñ 30 –¥–Ω—ñ–≤</h2>
    <div style="height: 300px; position: relative;">
        <canvas id="salesTrendChart"></canvas>
    </div>
</div>

<script>
    // –î–∞–Ω—ñ –¥–ª—è –≥—Ä–∞—Ñ—ñ–∫—É —Ç—Ä–µ–Ω–¥—ñ–≤ –ø—Ä–æ–¥–∞–∂—ñ–≤ –∑–∞ –æ—Å—Ç–∞–Ω–Ω—ñ 30 –¥–Ω—ñ–≤
    document.addEventListener('DOMContentLoaded', function() {
        const labels = [
            {% for employee in leaders %}
        "{{ employee.user.get_full_name }}",
        {% endfor %}
    ];
        const salesData = [
            {% for employee in leaders %}
        {{ employee.sales_count }},
        {% endfor %}
    ];

        // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≥—Ä–∞—Ñ—ñ–∫–∞ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Chart.js
        const ctx = document.getElementById('salesTrendChart').getContext('2d');
        const salesTrendChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: '–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ä–æ–¥–∞–∂—ñ–≤',
                    data: salesData,
                    backgroundColor: 'rgba(255, 119, 51, 0.7)',
                    borderColor: 'rgba(255, 119, 51, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: '–ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ä–æ–¥–∞–∂—ñ–≤'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(tooltipItem) {
                                return `–ü—Ä–æ–¥–∞–∂—ñ: ${tooltipItem.raw}`;
                            }
                        }
                    }
                }
            }
        });
    });
</script>

<div class="card" style="margin-top: 30px; background-color: var(--orange-50);">
    <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
        <div style="flex: 1; min-width: 300px;">
            <h2>–ú–æ—Ç–∏–≤–∞—Ü—ñ—è –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫—ñ–≤</h2>
            <p>–¢–∞–±–ª–∏—Ü—è –ª—ñ–¥–µ—Ä—ñ–≤ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î –Ω–∞–π—É—Å–ø—ñ—à–Ω—ñ—à–∏—Ö –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫—ñ–≤ –∑–∞ –æ—Å—Ç–∞–Ω–Ω—ñ 30 –¥–Ω—ñ–≤. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ü—ñ –¥–∞–Ω—ñ –¥–ª—è –º–æ—Ç–∏–≤–∞—Ü—ñ—ó –ø–µ—Ä—Å–æ–Ω–∞–ª—É —Ç–∞ –≤—ñ–¥–∑–Ω–∞—á–µ–Ω–Ω—è –Ω–∞–π–∫—Ä–∞—â–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤.</p>
        </div>
        <div style="flex: 0 0 auto;">
            <a href="{% url 'admin_dashboard' %}" class="btn">–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –ø–∞–Ω–µ–ª—ñ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</a>
        </div>
    </div>
</div>
{% endblock %}